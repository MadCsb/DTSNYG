<!DOCTYPE html>

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE9,chrome=1">
    <title>三农壹购</title>
    <meta name="keywords" content="三农壹购">
    <meta name="description" content="三农壹购">

    <script type="text/javascript" src="${rc.contextPath}/js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="${rc.contextPath}/js/jquery.cookie-1.4.1.min.js"></script>
    <script type="text/javascript" src="${rc.contextPath}/js/artDialog.js?skin=idialog"></script>
    <script type="text/javascript" src="${rc.contextPath}/js/jquery.validationEngine-zh_CN.js"></script>
    <script type="text/javascript" src="${rc.contextPath}/js/jquery.validationEngine.js"></script>

    <link href="${rc.contextPath}/web/css/base.css" rel="stylesheet" type="text/css">
    <link href="${rc.contextPath}/web/css/login.css" rel="stylesheet" type="text/css">

</head>
<body>
<input type="hidden" name="loginPage" value="${loginPage!'web'}">
<div class="login">
    <a href="webIndex?method=webIndex" class="h_logo"></a>
</div>

<div class="login_banner_panel">
    <div class="layout_panel">
        <div class="layout">
            <!--表单输入登录-->
            <h3>帐号登录</h3>
            <!-- tab con s -->
            <form id="syslogin">
                <input type="hidden" name="loginPage" value="${loginPage!'web'}">
                <!-- 输入框 -->
                <label class="labelbox">
                    <input class="validate[required]" autocomplete="off" type="text" name="userLoginName" id="userLoginName" placeholder="请输入用户名" value="${(user.userLoginName)!''}">
                </label>

                <label class="labelbox">
                    <input class="validate[required] item_account" type="password" placeholder="请输入密码" autocomplete="off" id="userPwd" name="userPwd" value="${(user.userPwd)!''}">
                </label>


                <label class="labelbox">
                    <input type="text" name="securityCode" maxlength="4" class="validate[required] text w180" placeholder="输入验证码" id="securityCode" value="" style="color: rgb(187, 187, 187); width:180px; display:inline-block;">
                    <span style="float:right; margin-top:10px; margin-right:10px;">
                        <img  src="${rc.contextPath}/verify_code.jsp" id="picsss"  title="更换验证码" onClick="replaceCode()" >
                    </span>
                </label>
                <p style="color:orange" id="errorMsg">用户名和密码区分大小写，请确认大小写功能是否打开</p>
            <input class="btnadpt" id="login-button" type="button" onclick="doLogin()" value="登录">

            <div class="n_links_area" id="custom_display_64">
                <a class="outer-link" href="toNewUser?loginPage=${loginPage!'web'}">立即注册</a><span style="display: none;">|</span>
                <a class="outer-link" href="wjmm.html" style="display: none;">忘记密码</a>
            </div>
            <!-- 其他登录方式 s -->
            <div style="display: none;" class="other_login_type">
                <fieldset class="oth_type_tit">
                    <legend align="center" class="oth_type_txt">其他方式登录</legend>
                </fieldset>
                <div class="oth_type_links">
                    <a class="" href=""><i class="icon_default_qq"></i></a>
                    <a class="" href=""><i class="icon_default_weixin"></i></a>
                </div>
            </div>
            <!-- 其他登录方式 e -->

            </form>
            <!-- tab con e -->
        </div>
    </div>


    <div class="n-footer">

        <div class="nf-link-area clearfix">
            <p>版权所有-三农壹购-<a class="" target="_blank" href=""><span><img src="${rc.contextPath}/web/images/ghs.png"></span>京ICP备18004270号</a></p>
        </div>
    </div>

</div>
<p id="redictUrl" style="display: none">${redictUrl!''}</p>
<form id="redictForm" action="" method="post"></form>
</body>

<script type="text/javascript">
    function doRedictForm()
    {
      $("#redictForm").html(""); //清空redictForm
      var redictUrl =$("#redictUrl").text(); //必须使用隐藏的p标签，通过text获取，才不会因为双引号或特殊字符转义造成信息丢失
      if (redictUrl.indexOf("/") == 0) //如果链接首个字符是/，则去掉
      {
        redictUrl = redictUrl.substring(1);
      }
      var paramIndex = redictUrl.indexOf("?"); //根据问号区分是否有参数
      if(paramIndex != -1) //如果有参数
      {
        $("#redictForm").attr("action",redictUrl.substring(0,paramIndex)); //设置action，method在后通过参数设置也可以
        var paramStr = redictUrl.substring(paramIndex+1);
        var paramArr = paramStr.split("&"); //分割所有参数

        for(var i=0;i<paramArr.length;i++)
        {
          var param = paramArr[i].split("="); //假设内容中没有等于号，分割参数的值和内容
          $("#redictForm").append('<input type=\'hidden\' name=\'' +param[0]+ '\' value=\'' +param[1]+ '\'>'); //保存参数和值
        }
      }else //如果没有参数
      {
        $("#redictForm").attr("action",redictUrl);
      }
      $("#redictForm").submit();
    }
    $( function() {
        $("#syslogin").validationEngine({
            validationEventTrigger : "blur"
        });
    });

    $("#syslogin").validationEngine({
        validationEventTrigger : "blur"
    });

    //点击更换验证码
    function replaceCode()
    {
        d = new Date().getTime();
        document.getElementById('picsss').src = '${rc.contextPath}/verify_code.jsp?a=' + d;
    };
    window.onload=function(){
      setTimeout("replaceCode()", 100);
    }
    function doLogin() {
      var userLoginName = $("#userLoginName").val();
      var userPwd = $("#userPwd").val();
      var securityCode = $("#securityCode").val();
      var userType = "${userType}";
      var roleType = "${roleType}";
      $.ajax({
        type: "POST",
        url: "login",
        dataType:"json",
        data: {
          userLoginName: userLoginName,
          userPwd: userPwd,
          securityCode: securityCode,
          userType:userType,
          roleType:roleType
        },
        success: function (data) {
          if(data.resultCode == '0')
          {
            if($("#redictUrl").text() == "")
            {
              window.location.href = "${rc.contextPath}/webPersonal.do?method=index";
            }else
            {
              doRedictForm();
            }
          }else
          {
            $("#errorMsg").html(data.resultMsg);
            replaceCode()
          }
        }
      })
    }

</script>
</head>