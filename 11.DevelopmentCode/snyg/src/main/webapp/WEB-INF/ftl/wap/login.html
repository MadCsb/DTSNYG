<!DOCTYPE html>

<html>
<head>
  <title>三农壹购</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="baidu-site-verification" content="XFQucHwK8v" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0;"/>
  <meta name="format-detection" content="telephone=no" />
  <meta name="keywords" content="三农壹购" />
  <meta name="description" content="三农壹购" />

  <link href="${rc.contextPath}/wap/css/wsc-3n1g.css" rel="stylesheet" />
  <link href="${rc.contextPath}/wap/js/flexslider/flexslider.css" rel="stylesheet" />
  <script src="${rc.contextPath}/wap/js/jquery-1.9.1.min.js"></script>
  <script src="${rc.contextPath}/wap/js/flexslider/jquery.flexslider-min.js"></script>
  <script src="${rc.contextPath}/wap/js/default.js"></script>
  <script type="text/javascript" src="${rc.contextPath}/wap/js/scrolltopcontrol.js"></script>
  <style>
    .snyg_xccon p { margin-bottom:6px;}
  </style>
</head>
<body style="background:#f6f6f8;">
    <input type="hidden" name="loginPage" value="${loginPage!'wap'}">
    <div><img src="wap/images/logobg.jpg" width="100%"></div>
    <div class="snyg_content">
      <h2 align="center" style="margin-top:12px;">用户登录</h2>
      <div class="snyg_xccon" style="background:transparent;">
        <p><input name="userLoginName" id="userLoginName" autocomplete="off" class="txt-input xm" type="text" placeholder="请输入用户名"></p>
        <p><input id="userPwd" name="userPwd" autocomplete="off" class="txt-input mm1" type="password" placeholder="请输入密码"></p>
        <p style="position:relative;">
          <input id="securityCode" name="securityCode" autocomplete="off" class="txt-input yzm" type="text" placeholder="请输入验证码">
          <span style=" position:absolute;top:4px; right:0;">
            <img src="${rc.contextPath}/verify_code.jsp" id="picsss"  title="更换验证码" onClick="replaceCode()">
          </span>
        </p>
        <div class="f2">
          <span style="vertical-align: middle; margin-left:10px;" id="errorMsg">用户名和密码区分大小写</span>
        </div>
      </div>
    </div>
    <a><div align="center"><button class="btn-big"  style="width:80%; margin-top:0;" onclick="doLogin()">登录</button></div></a>
    <a href="toNewUser?loginPage=${loginPage!'wap'}"><div align="center">立即注册</div></a>
    <p id="redictUrl" style="display: none">${redictUrl!''}</p>
    <form id="redictForm" action="" method="post"></form>
</body>
<script type="text/javascript">
  function doRedictForm()
  {
    $("#redictForm").html(""); //清空redictForm
    var redictUrl =$("#redictUrl").text(); //必须使用隐藏的p标签，通过text获取，才不会因为双引号或特殊字符转义造成信息丢失
    if (redictUrl.indexOf("/") == 0) //如果链接首个字符是/，则去掉
    {
      redictUrl = redictUrl.substring(1);
    }
    var paramIndex = redictUrl.indexOf("?"); //根据问号区分是否有参数
    if(paramIndex != -1) //如果有参数
    {
      $("#redictForm").attr("action",redictUrl.substring(0,paramIndex)); //设置action，method在后通过参数设置也可以
      var paramStr = redictUrl.substring(paramIndex+1);
      var paramArr = paramStr.split("&"); //分割所有参数

      for(var i=0;i<paramArr.length;i++)
      {
        var param = paramArr[i].split("="); //假设内容中没有等于号，分割参数的值和内容
        $("#redictForm").append('<input type=\'hidden\' name=\'' +param[0]+ '\' value=\'' +param[1]+ '\'>'); //保存参数和值
      }
    }else //如果没有参数
    {
      $("#redictForm").attr("action",redictUrl);
    }
    $("#redictForm").submit();
  }

    //点击更换验证码
    function replaceCode()
    {
        d = new Date().getTime();
        document.getElementById('picsss').src = '${rc.contextPath}/verify_code.jsp?a=' + d;
    }
    window.onload=function(){
      setTimeout("replaceCode()", 100);
    }

    function doLogin() {
        var userLoginName = $("#userLoginName").val();
        var userPwd = $("#userPwd").val();
        var securityCode = $("#securityCode").val();
        var userType = "${userType}";
        var roleType = "${roleType}";
        $.ajax({
          type: "POST",
          url: "login",
          dataType:"json",
          data: {
            userLoginName: userLoginName,
            userPwd: userPwd,
            securityCode: securityCode,
            userType:userType,
            roleType:roleType
          },
          success: function (data) {
            if(data.resultCode == '0')
            {
              if($("#redictUrl").text() == "")
              {
                window.location.href = "${rc.contextPath}/wappersonal.do?method=toPersonal";
              }else
              {
                doRedictForm();
              }
            }else
            {
              $("#errorMsg").html(data.resultMsg);
              replaceCode()
            }
          }
        })
    }

</script>
</head>