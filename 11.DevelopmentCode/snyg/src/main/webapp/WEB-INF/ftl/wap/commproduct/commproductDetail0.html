<!DOCTYPE html>
<html>
<head>
<#include "../WAP_INC_HEAD.html">  
<script src="${rc.contextPath}/wap/js/default.js"></script>
<script src="${rc.contextPath}/wap/js/coupon.js"></script>
<style>
.flexslider {
    margin: 0;
    box-sizing: border-box;
    overflow: hidden;
    border: 0px none;
    position: relative;
    zoom: 1;
 }
#navbar.navbar_fixed {
	position:fixed;
	top:0px;
	width:100%;
	background: #fafafa;
	height:1rem;
	z-index:99;
}
#navbar.navbar_absolute {
	position: relative;
	width:100%;
	background: #fafafa;
	height:1rem;
	z-index:99;
}
</style>


</head>
<body>


<a href="javascript:void(0)"><div class="gwc" style="display:none;"></div></a>
<a name="aaa"></a>
<input type="hidden" id="productId" name="productId" value="${commproduct.productId!''}"/>
<input type="hidden" id="priceType" name="priceType" value="${commproduct.priceType!''}"/>
<input type="hidden" id="priceId" name="priceId" value="${commproduct.priceId!''}"/>

<div class="flexslider" style="margin-top:0;">
    <ul class="slides">
    	<#if rsPicList?? && (rsPicList?size>0)>
    		<#list rsPicList as li>
        		<li><a href="#" title=""><img src="${rc.contextPath}/upload/wxpic/${li.picFileName!''}" alt="" title="" /></a></li>
        	 </#list>
    	</#if>
    </ul>
</div>
<div class="snyg_contentb"> 
    <div class="cpbtdiv">
         <p>${commproduct.productName!''}</p>
         <div class="ztwz" id="goodsPriceNameCheck"></div>
		 <div class="jgwz">&yen;${commproduct.price!''} <span class="f4" style="text-decoration:line-through; font-size:13px;"><#if commproduct.referencePrice?? && commproduct.referencePrice!=''>原价:&yen;${commproduct.referencePrice!''}</#if></span></div>
         <div class="zswz"><span id="kuaidi"></span><span style="float: right;display:none;">销量  ${commproduct.saleNum!'0'}</span></div>
    </div>
</div>
<#if coupon??>
<div class="snyg_contentb" > 
    <a href="javascript:void(0)" onclick="showCoupon('${commproduct.priceId!''}')">
    <div class="yhrkdiv">
         <div class="leftzi">优惠<span class="f1">平台优惠</span></div>
         <div class="centyhxx">
         	<div class="f2"></div>
          	<div></div>   
         </div>
         <div class="rzi">领券</div>
    </div>
    </a>
</div>
</#if>


<!-- 
<div class="navbar_absolute">
    <nav id="spxq_nav" class="spxq_nav">
        <a href="#aaa"><span class="spxq_navone">商品</span></a>
        <a href="#bbb"><span class="spxq_navtwo">详情</span></a>    
        <a href="#ccc"><span class="spxq_navtwo">评价</span></a>     </nav>
</div>
 -->




<div class="snyg_contentb" > 
<a name="bbb"></a>
    <div class="snyg_details_title" style="margin-top:10px;">商品介绍</div>
	<div class="spjscss">${commproduct.productInfo!''}</div>
</div>
<div class="clear6"></div>

<div class="snyg_contentb"> 
    <a href="javascript:void(0)">
    <div class="yhrkdiv">
         <div class="leftzi">购买须知</div>
    <!--     <div class="rzi">查看</div> -->
    </div>
    </a>

    <dl class="spgmxz"  style="height:190px; overflow-y:auto; overflow-x:hidden;">
        <dd><span>费用说明：</span><div>${commproduct.feeMemo!''}</div></dd>
        <dd><span>温馨提示：</span><div>${commproduct.tigInfo!''}</div></dd>
<!--         <dd><span>退改说明：</span><div>2018年7月1日</div></dd>
        <dd><span>费用包含：</span><div>2018年7月1日</div></dd>
        <dd><span>使用须知：</span><div>消费后凭订单号电话联系商家开取，发票金额为实际付款金额(不含优惠部分)</div></dd> -->
		<div class="clear6"></div>
    </dl>
</div>

<div class="snyg_contentb"> 
<a name="ccc"></a>
<!-- 
        <a href="商品详情-评价.html">
        <div class="yhrkdiv">
             <div class="leftzi">商品评价</div>
             <div class="rzi">更多</div>
        </div>
        </a>
    <ul class="sppj_list">
        <li>
            <h5>小雪花</h5>
           <div class="info">这是朋友分享给我买的，团购价很划算，推荐给身边的朋友，大家都可以买到放心的绿色农产品了。
           </div>
            <p class="txt">2019-09-23<span>规格：500克</span></p>
        </li>
        <li>
            <h5>小雪花</h5>
           <div class="info">这是朋友分享给我买的，团购价很划算，推荐给身边的朋友，大家都可以买到放心的绿色农产品了。
           </div>
            <p class="txt">2019-09-23<span>规格：500克</span></p>
        </li>
        <li>
            <h5>小雪花</h5>
           <div class="info">这是朋友分享给我买的，团购价很划算，推荐给身边的朋友，大家都可以买到放心的绿色农产品了。
           </div>
            <p class="txt">2019-09-23<span>规格：500克</span></p>
        </li>
        <li>
            <h5>小雪花</h5>
           <div class="info">这是朋友分享给我买的，团购价很划算，推荐给身边的朋友，大家都可以买到放心的绿色农产品了。
           </div>
            <p class="txt">2019-09-23<span>规格：500克</span></p>
        </li>

</ul>   
</div>
 -->
<!--商品规格--> 
<div id="tcyddiv" class="spggdiv" style="display:none;">
    <div class="snyg_content">
    	<div id="picAndPrice">
        </div>
        <dl class="spggfl"  style="height:150px; overflow-y:auto; overflow-x:hidden;">
            <dd><span>规格：</span>
                <div id="goodsPriceDiv">
                </div>
            </dd>
            <dd><span>数量：</span>
                 <div class="sl">
                    <button class="btnhui" onclick="changeNum('1')"></button>
                    <input id="num" type="text" readonly="readonly" class="input_sl" value="1">
                    <button class="btnadd" onclick="changeNum('2')"></button>
	            </div>
            </dd>
            <div class="clear6"></div>
        </dl>
	<div align="center"><a href="javascript:void(0)" onclick="addShopCart()"><button class="btn-big">确定</button></a></div>
    </div>
</div>
</div>
<div class="clear6"></div>
<!--预订menu开始--> 
  <nav class="snyg_nav">
        <a href="tel:400-8013841"><span class="wid6"><i class="kfico"></i>联系客服</span></a>
        <a onclick="ydShow('1')" href="javascript:void(0)"title=""><span class="orange_btn wid3" >加入购物车</span></a>
        <a onclick="ydShow('2')" href="javascript:void(0)" ><span class="green_btn wid3" >立即购买</span></a></nav>
<!--预订menu结束-->

</div>

<form action="waporder?method=toCreateOrder" method="post" id="toCreateOrder">
  <input type="hidden" name="prepareOrderJson" id="prepareOrderJson" value="">
</form>
<script>


var alertHtml = "";
	$(function(){
		getSellPriceList();			
		
		window.addEventListener("popstate", function(e) {  
		 //  alert("我监听到了浏览器的返回按钮事件啦");//根据自己的需求实现自己的功能  
		}, false);
		
	//	queryCouponList();
	});  
	
	
	var checkPriceId = "";
	
	function addShopCart(){
		if(showType == "1"){
			$.post("wap?method=checkLogin",{
				
			},function(data){
				if(data.resultCode=='0'){
					$.post("wapShopcart?method=toAddOrUpdateShopCart",{
						priceId:checkPriceId,
						num:$("#num").val()
					},function(data){
						if(data=="success"){
							closeBottomHtml();
							Alert.showMsg("加入购物车成功");
						}
					});
				}else{
					closeBottomHtml();
					Alert.showConfirmMsg("您还没有登录，请先登录",'toLogin');
				}
			},'json')
			
		}else{
			submitOrder();
		}
	}
	
	
	
	function getSellPriceList(){
		$.post("wapSellPrice?method=queryGoodsPriceListForWx",{
			productId:$("#productId").val(),
			priceType:$("#priceType").val(),
			delFlag:'0'
		},function(data){
			if(data!=null && data.length>0){
				var str = "";
				var str1 = "";
				for(var i=0;i<data.length;i++){
					str+='<div class="spgg_title"';
					if($("#priceId").val() ==  data[i].priceId){
						checkPriceId = data[i].priceId;
						if(data[i].freight == ""){
							$("#kuaidi").html("快递 免运费");
						}else{
							$("#kuaidi").html("快递 "+data[i].freight);
						}
						
						$("#goodsPriceNameCheck").html(data[i].priceName);
					}else{
						str+="style='display:none;'"
					}
					str+=' id="pricePic'+data[i].priceId+'">';
					str+='<div class="sptucss"><img src="${rc.contextPath}/upload/wxpic/'+data[i].thumbPic+'"></div>';
					str+='<span class="f1" style="margin-left:120px; line-height:50px;">&yen;'+data[i].price+'</span><a class="closdiv" onclick="ydNone()"></a>';      
					str+='</div>';
					
					if($("#priceId").val() ==  data[i].priceId){
						str1+='<button class="spggflon" onclick="checkGoodsPrice(\''+data[i].priceId+'\',this)">'+data[i].priceName+'</button>';
					}else{
						str1+='<button class="spggfloff" onclick="checkGoodsPrice(\''+data[i].priceId+'\',this)">'+data[i].priceName+'</button>';
					}
				}
				$("#picAndPrice").html(str);
				$("#goodsPriceDiv").html(str1);
			}
			
			alertHtml = $("#tcyddiv").html()
			$("#tcyddiv").remove();
		},'json');
	}
	
	function checkGoodsPrice(priceId,obj){
		$(".spgg_title").hide();
		$("#pricePic"+priceId).show();
		
		$(".spggflon").removeClass("spggflon").addClass("spggfloff");
		$(obj).removeClass("spggfloff").addClass("spggflon");
		
		checkPriceId = priceId;
	}
	
	function changeNum(type){
		var num = parseInt($("#num").val());
		if(type=="1"){
			if(num >1){
				num --;
			}else{
				num = 1;
			}
		}else{
			num++;
		}
		$("#num").val(num)
	}
	function submitOrder(){
		var prepareOrderJson = new Object();
		  var orderListList = new Array();
		  var orderList1 = new Object();
		  orderList1.priceId =checkPriceId; //销售id
		  orderList1.num = $("#num").val(); //数量
		  orderList1.cartId = ""; //购物车id
		  //price_1_refPatchCode
		  orderListList.push(orderList1);
		  prepareOrderJson.orderListList = orderListList;
		  $("#prepareOrderJson").val(JSON.stringify(prepareOrderJson));
		  $("#toCreateOrder").submit();
	}
	var showType = "";
	function ydShow(showTypeInfo)
	{
	   showType = showTypeInfo;
	   //document.getElementById("tcyddiv").style.display="block";
	  // alert(alertHtml);
	   Alert.showBottomHtml(alertHtml);
		$("#alert_show_3").css("height", "290");
	}
	function ydNone()
	{
	//   document.getElementById("tcyddiv").style.display="none";
		closeBottomHtml();
	}
	
	window.history.go(2);
	
	function queryCouponList(){
		var priceType = $("#priceType").val();
		var priceId = $("#priceId").val();
		$.post("wapCoupon?method=queryCouponList",{
			priceType:priceType,
			priceId:priceId
		},function(data){
		},'json')
	}
</script>


</body>
</html>
