<!DOCTYPE html>
<html>
<head>
<link href="${rc.contextPath}/wap/css/font-awesome.min.css" rel="stylesheet" />
<link href="${rc.contextPath}/wap/css/framework7.ios.colors.min.css" rel="stylesheet" />
<link href="${rc.contextPath}/wap/css/framework7.ios.min.css" rel="stylesheet" />
<script src="${rc.contextPath}/wap/js/framework7.min.js"></script>
<script src="${rc.contextPath}/wap/js/jquery.min.js"></script>
<#include "../WAP_INC_HEAD.html">  
</head>
<body>

<!--header 结束-->

<form action="" method="post" id="createConsignee">
<div class="snyg_content">
		
     	<input type="hidden" id="" name="isDefault" value="${consignee.isDefault!''}">
     		<input type="hidden" name="spId" id="spId" value="${spId!''}" />
			<input type="hidden" name="province" id="province" value="${province!''}" />
			<input type="hidden" name="consigneeId" id="consigneeId" value="${consignee.consigneeId!''}" /> 
	<div class="snyg_xccon">
     <p>
     	<input id="name" class="txt-input xm" type="text" placeholder="收货人姓名"
						value="${consignee.custName!''}" name="custName">
     </p>
          
     <p>
     	<input id="link" class="txt-input sj" pattern="[0-9]*" pattern="\d" type="number" placeholder="手机号"
						value="${consignee.custPhone!''}" name="custPhone">
     </p> 
     <p>
		<input id="location" class="txt-input dz" type="text" placeholder="所在地区"
				value="${consignee.pcx!''}"		name="location">
     </p>
     <p>
     	<input id="recAddress" class="txt-input dz" type="text"
			value="${consignee.recAddress!''}"		placeholder="收货地址" name="recAddress">
     </p>
    <!-- 
     <div class="text_c"><label>
        <input  type="radio"  value="radio" hidden/>
        <label for="radio" class="radiock"></label>
    	<span class="f1" style="vertical-align: middle; margin-left:10px;">设为默认</span></div></label>      
	</div>
	 -->
</div>
	<div align="center"><button class="btn-big" type="button" onclick="beforeSubmit()">保存</button></div>
</form>
<script>
  $(function(){
    $("input").on('keydown', function() {
      window.focus();
    });
  })

function beforeSubmit() {
	/*var item = $("input[type='radio']").is(':checked');
	if (item == true) {
		$("#isDefault").val("1");
	} else {
		$("#isDefault").val("0");
	}*/
	var name = $("#name").val();
	var link = $("#link").val();
	var recAddress = $("#recAddress").val();
	var pcx = $("#location").val();

	// 姓名必填
	if (name == "") {
		Alert.showMsg("收货人姓名必填");
		return false;
	}

	// 姓名长度
	if (name != "" && getStrLengthCom(name) > 50) {
		Alert.showMsg("姓名不能超过50位（中文算2位）");
		return;
	}

	// 联系电话必填
	if (link == "") {
		Alert.showMsg("手机号必填");
		return;
	}

	// 手机号验证
	if (!link || !/^[1][3,4,5,7,8][0-9]{9}$/.test(link)) {
		Alert.showMsg("手机号格式错误");	
		return;
	}

	// 地区必填
	if (pcx == "") {
		Alert.showMsg("收货地区必填");
		return;
	}
	
	// 地址必填
	if (recAddress == "") {
		Alert.showMsg("收货地址必填");
		return;
	}

	// 地址长度
	if (recAddress != "" && getStrLengthCom(recAddress) > 500) {
		Alert.showMsg("收货地址不能超过500位（中文算2位）");
		return;
	}
	
	$("#spanPay").css("display", "none");
	
	$.post("wapConsignee.do?method=updateConsignee",{
		custName:$("#name").val(),
		custPhone:$("#link").val(),
		recAddress:$("#recAddress").val(),
		isDefault:$("#isDefault").val(),
		pcx:$("#location").val().trim(),
		consigneeId:$("#consigneeId").val()
	},function(data) {
		if(data=="success"){
			 toConsigneeList();
		}
	});
}

function toConsigneeList(){
	window.location.href='wapConsignee?method=toQueryConsignee';
}

/**
*
* ajax获取city列表
* */
function getCityList(queryObj) {
 var cityList = new Array();
 $.ajax({
   type: "POST",
   async: false,
   dataType: "json",
   url: "city?method=getCityJson",
   data: queryObj,
   success: function (data) {
     for(var i=0;i<data.length;i++)
			{
       cityList.push(data[i].cityName);
			}
   }
 });
 return cityList;
}
var firstCity = "";
/**
* [getProvince 获取省]
*/
function getProvince() {
 var queryObj = new Object();
 queryObj.cityLevel = '1'; //省份cityLevel = 1
	var p = getCityList(queryObj);
	return p;
}

/**
* [getCity 获取市]
* @param  provinceName
*/
function getCity(provinceName) {
 var queryObj = new Object();
 queryObj.cityLevel = '2'; //城市cityLevel = 2
 queryObj.province = provinceName;
 var c = getCityList(queryObj);
 return c;
}

/**
* [getArea 获取区]
* @param  provinceName [省名]
* @param  cityName     [市名]
*/
function getArea(provinceName, cityName) {
 var queryObj = new Object();
 queryObj.cityLevel = '3'; //县cityLevel = 3
 queryObj.province = provinceName;
 queryObj.city = cityName;
 var x = getCityList(queryObj);
 return x;
}

//初始化 Framework7
var myApp = new Framework7();

var provinceSelect = "";// 保存 picker 选择的省
var citySelect = "";// 保存 picker 选择的市
var province = getProvince();
var city = getCity(province[0]);
var area = getArea(province[0], city[0]);

//省市区联动 / Framework7 picker
var pickerLocation = myApp
		.picker({
			input : '#location',
			rotateEffect : true,
			toolbarTemplate : '<div class="toolbar">\
                   <div class="toolbar-inner">\
                       <div class="left">\
                           <a href="#" class="link close-picker">取消</a>\
                       </div>\
                       <div class="right">\
                           <a href="#" class="link close-picker">完成</a>\
                       </div>\
                   </div>\
               </div>',
			cols : [ {
				cssClass : 'f-s-14',
				width : '33.33%',
				textAlign : 'left',
				values : province,
				onChange : function(picker, provinceNow) {
				  console.log(1);
					if (picker.cols[1].replaceValues) {
						provinceSelect = provinceNow;
						city = getCity(provinceSelect);
						area = getArea(provinceSelect, city[0]);
						picker.cols[1].replaceValues(city);
						if (area.length !== 0) {
							picker.cols[2].replaceValues(area);
						} else {
							picker.cols[2].replaceValues(" ");
						}
					}
				}
			}, {
				cssClass : 'f-s-14',
				width : '33.33%',
				textAlign : 'center',
				values : city,
				onChange : function(picker, cityNow) {
         console.log(2);
					if (picker.cols[2].replaceValues) {
           citySelect = cityNow;
						area = getArea(provinceSelect, citySelect);
						if (area.length !== 0) {
							picker.cols[2].replaceValues(area);
						} else {
							picker.cols[2].replaceValues(" ");
						}
					}
				}
			}, {
				cssClass : 'f-s-14',
				width : '33.33%',
				textAlign : 'right',
				values : area
			} ]
		});
</script>
</body>
</html>
