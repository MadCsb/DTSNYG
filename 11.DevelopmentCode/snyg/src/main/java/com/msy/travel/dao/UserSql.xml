<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.msy.travel.dao.UserDao">
	<!-- 按条件查询所有 -->
	<select id="queryUserList" parameterType="User"
			resultType="User">
		SELECT
		u.F_USER_ID as userId ,
		u.F_USER_LOGINNAME as userLoginName ,
		u.F_USER_NAME as userName ,
		u.F_USER_DESC as userDesc ,
		u.F_USER_PWD as userPwd ,
		u.F_USER_TEL as userTel ,
		u.F_USER_MOBILE as userMobile ,
		u.F_USER_EMAIL as userEmail ,
		u.F_USER_ADDR as userAddr ,
		u.F_USER_REG_DATE as userRegDate ,
		u.F_USER_STATE as userState ,
		u.F_USER_IP as userIp ,
		u.F_USER_LOCKED as userLocked ,
		u.F_USER_LOCKTIME as userLockTime ,
		u.F_STOREID as storeId ,
		u.F_WXSERVICEID as wxServiceId ,
		u.F_TYPE as type,
		u.F_COUNTRY as country,
		u.F_CITY as city,
		u.F_PROVINCE as province,
		u.F_SEX as sex,
		u.F_UPDATETIME as updateTime,
		u.F_UNIONID as unionId
		FROM
		t_pub_user u
		<where>
			<if test="userName!=null and userName!='' ">
				u.F_USER_NAME like concat('%',#{userName},'%') 
			</if>
			<if test="userLoginName!=null and userLoginName!='' ">
				and u.F_USER_LOGINNAME like concat('%',#{userLoginName},'%')
			</if>
			<if test="type!=null and type!='' ">
				and u.F_TYPE = #{type}
			</if>
			<if test="unionId!=null and unionId!='' ">
				and u.F_UNIONID = #{unionId}
			</if>
			<if test='delFlag != null and delFlag =="0" '>
				and u.f_user_state != '-1'
			</if>
		</where>
		<if test="entityPage!=null">
			<if test="entityPage.sortField !=null and entityPage.sortField != '' ">
				ORDER BY ${entityPage.sortField}
			</if>
		</if>
		<if test="entityPage!=null">
			<if test="entityPage!=null and entityPage.sortOrder !=null and entityPage.sortOrder !='' ">
				 ${entityPage.sortOrder}
			</if>
		</if>
	</select>

	<!-- 修改信息 -->
	<update id="updateUser" parameterType="User">
		UPDATE
		t_pub_user
		<set>
			<if test="userName !=null">F_USER_NAME  = #{userName} ,</if>
			<if test="userDesc !=null">F_USER_DESC  = #{userDesc} ,</if>
			<if test="userTel !=null">F_USER_TEL  = #{userTel} ,</if>
			<if test="userMobile !=null">F_USER_MOBILE  = #{userMobile} ,</if>
			<if test="userEmail !=null">F_USER_EMAIL  = #{userEmail} ,</if>
			<if test="userAddr !=null">F_USER_ADDR  = #{userAddr} ,</if>
			<if test="userState !=null">F_USER_STATE  = #{userState} ,</if>
			<if test="userIp !=null">F_USER_IP  = #{userIp} ,</if>
			<if test="userLocked !=null">F_USER_LOCKED  = #{userLocked} ,</if>
			<if test="userLockTime !=null">F_USER_LOCKTIME  = #{userLockTime} ,</if>
			<if test="storeId !=null">F_STOREID  = #{storeId} ,</if>
			<if test="wxServiceId !=null">F_WXSERVICEID  = #{wxServiceId} ,</if>
			<if test="type !=null">F_TYPE  = #{type} ,</if>
			<if test="country !=null">F_COUNTRY  = #{country} ,</if>
			<if test="city !=null">F_CITY  = #{city} ,</if>
			<if test="province !=null">F_PROVINCE  = #{province} ,</if>
			<if test="sex !=null">F_SEX  = #{sex} ,</if>
			<if test="updateTime !=null">F_UPDATETIME  = #{updateTime} ,</if>
			<if test="headPic !=null">F_HEADPIC  = #{headPic} ,</if>
			<if test="unionId !=null">F_UNIONID  = #{unionId} ,</if>
		</set>
		WHERE
		F_USER_ID = #{userId}
	</update>


	<!-- 修改属性为null -->
	<update id="updateColNull" parameterType="User">
		UPDATE
		t_pub_user
		<set>
			<foreach collection="colList" item="param">
				<if test="param == 'unionId'">F_UNIONID  = NULL ,</if>
			</foreach>
		</set>
		WHERE
		F_USER_ID = #{userId}
	</update>


	<select id="getUserCount" resultType="int" parameterType="User">
		SELECT
		COUNT(*)
		from t_pub_user u
		<where>
			<if test="delFlag != null and delFlag =='0' ">
				and u.f_user_state != '-1'
			</if>
			<if test="userState != null and userState != '' ">
				and u.f_user_state = #{userState}
			</if>
			<if test="userName != null and userName != '' ">
				and u.F_USER_NAME like concat('%',#{userName},'%') 
			</if>
			<if test="userLoginName != null and userLoginName != '' ">
				and u.F_USER_LOGINNAME like concat('%',#{userLoginName},'%') 
			</if>
		</where>
	</select>

	<select id="queryUserByPage" parameterType="User" resultType="User">
		SELECT
		f_user_id as userId,
		f_user_name as userName,
		f_user_loginname as userLoginName,
		f_user_mobile as userMobile,
		f_user_tel as userTel,
		f_user_email as userEmail,
		f_user_reg_date as userRegDate,
		f_user_state as userState,
		f_storeid as storeId,
		F_USER_LOCKED as userLocked ,
		F_UNIT_NAME as unitName ,
		F_WXSERVICEID as wxServiceId ,
		F_TYPE as type
		FROM
		(SELECT row_.*, rownum rownum_ FROM (
		select
		u.f_user_id,
		u.f_user_name,
		u.f_user_loginname,
		u.f_user_tel,
		u.f_user_mobile,
		u.f_user_email,
		u.f_user_reg_date,
		u.f_user_state,
		u.f_storeid,
		u.F_USER_LOCKED,
		u.F_WXSERVICEID as wxServiceId ,
		u.F_TYPE as type
		from t_pub_user u


		<where>
			<if test=" delFlag != null and delFlag == '0' ">
				and u.f_user_state != '-1'
			</if>
			<if test="userState !=null and userState != '' ">
				and u.f_user_state=#userState#
			</if>
			<if test="userName != null and userName != '' ">
				and u.F_USER_NAME like concat('%',#{userName},'%') 
			</if>
			<if test="userLoginName != null and userLoginName != '' ">
				and u.F_USER_LOGINNAME like concat('%',#{userLoginName},'%') 
			</if>
		</where>
		<if test="entityPage!=null">
			<if test="entityPage.sortField !=null and entityPage.sortField != '' ">
				ORDER BY ${entityPage.sortField}
			</if>
		</if>
		<if test="entityPage!=null">
			<if test="entityPage!=null and entityPage.sortOrder !=null and entityPage.sortOrder !='' ">
				 ${entityPage.sortOrder}
			</if>
		</if>
		)row_ WHERE rownum &lt;= ${entityPage.rowsPerPage})row_ WHERE rownum_ &gt;
		${entityPage.pageBegin}
	</select>

	<!-- 查询单个详情 -->
	<select id="queryUser" parameterType="User"
			resultType="User">
		SELECT
		u.F_USER_ID as userId ,
		u.F_USER_LOGINNAME as userLoginName ,
		u.F_USER_NAME as userName ,
		u.F_USER_DESC as userDesc ,
		u.F_USER_PWD as userPwd ,
		u.F_USER_TEL as userTel ,
		u.F_USER_MOBILE as userMobile ,
		u.F_USER_EMAIL as userEmail ,
		u.F_USER_ADDR as userAddr ,
		u.F_USER_REG_DATE as userRegDate ,
		u.F_USER_STATE as userState ,
		u.F_USER_IP as userIp ,
		u.F_USER_LOCKED as userLocked ,
		u.F_USER_LOCKTIME as userLockTime ,
		u.F_STOREID as storeId ,
		u.F_WXSERVICEID as wxServiceId ,
		u.F_TYPE as type,
		u.F_COUNTRY as country,
		u.F_CITY as city,
		u.F_PROVINCE as province,
		u.F_SEX as sex,
		u.F_HEADPIC as headPic,
		u.F_UPDATETIME as updateTime,
		u.F_UNIONID as unionId
		FROM
		t_pub_user u
		WHERE
		F_USER_ID = #{userId}
	</select>

	<!-- 新增信息 -->
	<insert id="insertUser" parameterType="User">
		INSERT INTO t_pub_user (
		F_USER_ID,
		F_USER_LOGINNAME,
		F_USER_NAME,
		F_USER_DESC,
		F_USER_PWD,
		F_USER_TEL,
		F_USER_MOBILE,
		F_USER_EMAIL,
		F_USER_ADDR,
		F_USER_REG_DATE,
		F_USER_STATE,
		F_USER_IP,
		F_USER_LOCKED,
		F_USER_LOCKTIME,
		F_STOREID,
		F_WXSERVICEID ,
		F_TYPE ,
		F_COUNTRY ,
		F_CITY ,
		F_PROVINCE ,
		F_SEX  ,
		F_UPDATETIME   ,
		F_HEADPIC ,
		F_UNIONID
		) VALUES (
		#{userId,jdbcType=VARCHAR} ,
		#{userLoginName,jdbcType=VARCHAR} ,
		#{userName,jdbcType=VARCHAR} ,
		#{userDesc,jdbcType=VARCHAR} ,
		#{userPwd,jdbcType=VARCHAR} ,
		#{userTel,jdbcType=VARCHAR} ,
		#{userMobile,jdbcType=VARCHAR} ,
		#{userEmail,jdbcType=VARCHAR} ,
		#{userAddr,jdbcType=VARCHAR} ,
		#{userRegDate,jdbcType=VARCHAR} ,
		#{userState,jdbcType=VARCHAR} ,
		#{userIp,jdbcType=VARCHAR} ,
		#{userLocked,jdbcType=VARCHAR} ,
		#{userLockTime,jdbcType=VARCHAR} ,
		#{storeId,jdbcType=VARCHAR} ,
		#{wxServiceId,jdbcType=VARCHAR},
		#{type,jdbcType=VARCHAR},
		#{country,jdbcType=VARCHAR},
		#{city,jdbcType=VARCHAR},
		#{province,jdbcType=VARCHAR},
		#{sex,jdbcType=VARCHAR},
		#{updateTime,jdbcType=VARCHAR},
		#{headPic,jdbcType=VARCHAR} ,
		#{unionId,jdbcType=VARCHAR} 
		)
	</insert>

	<!-- 修改信息 -->
	<update id="updateUserPWD" parameterType="User">
		UPDATE
		t_pub_user
		SET
		F_USER_PWD = #{userPwd}
		WHERE
		F_USER_ID = #{userId}
	</update>
	
	<!-- 登录时查询  -->
	<select id="queryUserListByLogin" parameterType="User" resultType="User">
		SELECT
		u.F_USER_ID as userId ,
		u.F_USER_LOGINNAME as userLoginName ,
		u.F_USER_NAME as userName ,
		u.F_USER_DESC as userDesc ,
		u.F_USER_PWD as userPwd ,
		u.F_USER_TEL as userTel ,
		u.F_USER_MOBILE as userMobile ,
		u.F_USER_EMAIL as userEmail ,
		u.F_USER_ADDR as userAddr ,
		u.F_USER_REG_DATE as userRegDate ,
		u.F_USER_STATE as userState ,
		u.F_USER_IP as userIp ,
		u.F_USER_LOCKED as userLocked ,
		u.F_USER_LOCKTIME as userLockTime ,
		u.F_STOREID as storeId ,
		u.F_WXSERVICEID as wxServiceId ,
		u.F_TYPE as type ,
		u.F_COUNTRY as country,
		u.F_CITY as city,
		u.F_PROVINCE as province,
		u.F_SEX as sex,
		u.F_HEADPIC as headPic,
		u.F_UPDATETIME as updateTime,
		u.F_UNIONID as unionId
		FROM
		t_pub_user u
		<where>
			u.F_USER_STATE = '1'
			<if test="userLoginName!=null and userLoginName!='' ">
			AND u.F_USER_LOGINNAME = #{userLoginName} AND LENGTH(u.F_USER_LOGINNAME) = LENGTH(#{userLoginName})
			</if>
			<if test="type!=null and type!='' ">
				AND u.F_TYPE  = #{type}
			</if>

		</where>
	</select>
	


	<!-- 根据用户登录名查询单个User信息 -->
	<select id="selectUserByUserLoginName" parameterType="User"
			resultType="User">
		SELECT
		u.F_USER_ID as userId ,
		u.F_USER_LOGINNAME as userLoginName ,
		u.F_USER_NAME as userName ,
		u.F_USER_DESC as userDesc ,
		u.F_USER_PWD as userPwd ,
		u.F_USER_TEL as userTel ,
		u.F_USER_MOBILE as userMobile ,
		u.F_USER_EMAIL as userEmail ,
		u.F_USER_ADDR as userAddr ,
		u.F_USER_REG_DATE as userRegDate ,
		u.F_USER_STATE as userState ,
		u.F_USER_IP as userIp ,
		u.F_USER_LOCKED as userLocked ,
		u.F_USER_LOCKTIME as userLockTime ,
		u.F_STOREID as storeId ,
		u.F_WXSERVICEID as wxServiceId ,
		u.F_TYPE as type ,
		u.F_COUNTRY as country,
		u.F_CITY as city,
		u.F_PROVINCE as province,
		u.F_SEX as sex,
		u.F_UPDATETIME as updateTime,
		u.F_HEADPIC as headPic,
		u.F_UNIONID as unionId
		FROM
		t_pub_user u
		<where>
			1=1
			<if test="userLoginName!=null and userLoginName!=''">
				and u.F_USER_LOGINNAME = #{userLoginName}
			</if>
			<if test="userState!=null and userState!=''">
				and u.F_USER_STATE = #{userState}
			</if>
			<if test="wxServiceId !=null and wxServiceId !=''">
				and u.F_WXSERVICEID = #{wxServiceId}
			</if>
		</where>
	</select>
<!-- 按条件查询所有 -->
	<select id="queryUserListByType" parameterType="User"
			resultType="User">
	SELECT
		u.F_USER_ID as userId ,
		u.F_USER_LOGINNAME as userLoginName ,
		u.F_USER_NAME as userName ,
		u.F_USER_DESC as userDesc ,
		u.F_USER_PWD as userPwd ,
		u.F_USER_TEL as userTel ,
		u.F_USER_MOBILE as userMobile ,
		u.F_USER_EMAIL as userEmail ,
		u.F_USER_ADDR as userAddr ,
		u.F_USER_REG_DATE as userRegDate ,
		u.F_USER_STATE as userState ,
		u.F_USER_IP as userIp ,
		u.F_USER_LOCKED as userLocked ,
		u.F_USER_LOCKTIME as userLockTime ,
		u.F_STOREID as storeId ,
		u.F_WXSERVICEID as wxServiceId ,
		u.F_TYPE as type,
		u.F_COUNTRY as country,
		u.F_CITY as city,
		u.F_PROVINCE as province,
		u.F_SEX as sex,
		u.F_UPDATETIME as updateTime,
		u.F_HEADPIC as headPic
		FROM
		t_pub_user u
		<where>
			<if test="userName!=null and userName!='' ">
				u.F_USER_NAME like concat('%',#{userName},'%') 
			</if>
			<if test="userLoginName!=null and userLoginName!='' ">
				and u.F_USER_LOGINNAME like concat('%',#{userLoginName},'%')
			</if>
			<if test="city != null and city != ''">
				and (u.F_CITY like concat('%',#{city},'%') or u.F_PROVINCE like concat('%',#{city},'%') or u.F_COUNTRY like concat('%',#{city},'%'))
			</if>
			<if test="type != null and type != ''">
				and u.F_TYPE = #{type}
			</if>
			<if test="sex != null and sex != ''">
				and u.F_SEX = #{sex}
			</if>
			<if test="updateTimeStart != null and updateTimeStart != ''">
				and u.F_UPDATETIME &gt;= concat(#{updateTimeStart},' 00:00:00')
			</if>
			<if test="updateTimeEnd != null and updateTimeEnd != ''">
				and u.F_UPDATETIME &lt;= concat(#{updateTimeEnd},' 23:59:59')
			</if>
			<if test="userMobile !=null and userMobile !='' ">
				and u.F_USER_MOBILE like concat('%',#{userMobile},'%') 
			</if>
			<if test="userEmail !=null and userEmail !='' ">
				and u.F_USER_EMAIL like concat('%',#{userEmail},'%') 
			</if>
		</where>
		<if test="entityPage!=null">
			<if test="entityPage.sortField !=null and entityPage.sortField != '' ">
				ORDER BY ${entityPage.sortField}
			</if>
		</if>
		<if test="entityPage!=null">
			<if test="entityPage!=null and entityPage.sortOrder !=null and entityPage.sortOrder !='' ">
				 ${entityPage.sortOrder}
			</if>
		</if>
	</select>
	
	<select id="getUserCountFromAdd" resultType="int" parameterType="User">
		SELECT
		COUNT(*)
		from t_pub_user u
		<where>
			<if test='delFlag != null and delFlag =="0" '>
				and u.f_user_state != '-1'
			</if>
			<if test="userState != null and userState != '' ">
				and u.f_user_state = #{userState}
			</if>
			<if test="userLoginName != null and userLoginName != '' ">
				and u.F_USER_LOGINNAME = #{userLoginName} 
			</if>
		</where>
	</select>
	
	<!-- 根据roledata查询  -->
	<select id="queryUserListAndRoleData" parameterType="User" resultType="User">
	SELECT
		u.F_USER_ID AS userId,
		u.F_USER_LOGINNAME AS userLoginName,
		u.F_USER_NAME AS userName,
		u.F_USER_DESC AS userDesc,
		u.F_USER_PWD AS userPwd,
		u.F_USER_TEL AS userTel,
		u.F_USER_MOBILE AS userMobile,
		u.F_USER_EMAIL AS userEmail,
		u.F_USER_ADDR AS userAddr,
		u.F_USER_REG_DATE AS userRegDate,
		u.F_USER_STATE AS userState,
		u.F_USER_IP AS userIp,
		u.F_USER_LOCKED AS userLocked,
		u.F_USER_LOCKTIME AS userLockTime,
		u.F_STOREID AS storeId,
		u.F_WXSERVICEID AS wxServiceId,
		u.F_TYPE AS type,
		u.F_COUNTRY AS country,
		u.F_CITY AS city,
		u.F_PROVINCE AS province,
		u.F_SEX AS sex,
		u.F_UPDATETIME AS updateTime,
		u.F_HEADPIC AS headPic,
		u.F_UNIONID as unionId
	FROM
		t_pub_roledata r 
	LEFT JOIN 
		t_pub_user u on u.F_USER_ID = r.F_USERID
		<where>
			<if test="userName!=null and userName!='' ">
				u.F_USER_NAME like concat('%',#{userName},'%') 
			</if>
			<if test="userLoginName!=null and userLoginName!='' ">
				and u.F_USER_LOGINNAME like concat('%',#{userLoginName},'%')
			</if>
			<if test="city != null and city != ''">
				and (u.F_CITY like concat('%',#{city},'%') or u.F_PROVINCE like concat('%',#{city},'%') or u.F_COUNTRY like concat('%',#{city},'%'))
			</if>
			<if test="type != null and type != ''">
				and u.F_TYPE = #{type}
			</if>
			<if test="sex != null and sex != ''">
				and u.F_SEX = #{sex}
			</if>
			<if test="updateTimeStart != null and updateTimeStart != ''">
				and u.F_UPDATETIME &gt;= concat(#{updateTimeStart},' 00:00:00')
			</if>
			<if test="updateTimeEnd != null and updateTimeEnd != ''">
				and u.F_UPDATETIME &lt;= concat(#{updateTimeEnd},' 23:59:59')
			</if>
			<if test="userMobile !=null and userMobile !='' ">
				and u.F_USER_MOBILE like concat('%',#{userMobile},'%') 
			</if>
			<if test="userEmail !=null and userEmail !='' ">
				and u.F_USER_EMAIL like concat('%',#{userEmail},'%') 
			</if>
			<if test="roleType != null and roleType != ''">
				and r.F_ROLETYPE = #{roleType}
			</if>
			<if test='delFlag != null and delFlag =="0" '>
				and u.f_user_state != '-1'
			</if>
		</where>
		<if test="entityPage!=null">
			<if test="entityPage.sortField !=null and entityPage.sortField != '' ">
				ORDER BY ${entityPage.sortField}
			</if>
		</if>
		<if test="entityPage!=null">
			<if test="entityPage!=null and entityPage.sortOrder !=null and entityPage.sortOrder !='' ">
				 ${entityPage.sortOrder}
			</if>
		</if>
	</select>
</mapper>